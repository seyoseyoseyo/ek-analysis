import sys
import csv
import matplotlib.pyplot as plt
import datetime

twitter_name = sys.argv[1]
path = 'database/' + twitter_name + '.csv'
ek_list = ["rig", "magnitude", "terror", "sundown", "nebula", "kaixin", "angler", "neutrino", "fiesta", "orange", "gongdad", "gondad", "flashpack", "zuponcic", "infinity", "blackhole", "dotkachef", "nuclear", "astrum", "gongda"]
colour_list = ['#FF4500', '#FAEBD7', '#DB7093', '#000000', '#0000FF', '#8A2BE2', '#A52A2A', '#DEB887', '#5F9EA0', '#7FFF00', '#FF7F50', '#DC143C', '#00008B', '#006400', '#8FBC8F', '#2F4F4F', '#FF1493', '#FFD700', '#ADFF2F', '#F0E68C']
unique_ek = []
frequency_list  = []


def get_month(thatdate):
  today = datetime.date.today()
  if thatdate.year == today.year:
    month_diff = today.month - thatdate.month
    if thatdate.day > today.day:
      month_diff -= 1
  else:
    month_diff = 12 - (thatdate.month - today.month)
    if thatdate.day > today.day:
      month_diff -= 1
  return month_diff

def resort(list, order):
  result = []
  for e in order:
    if e in list:
      result.append(e)
  return result  


def check(body):  
  output = []
  length = len(ek_list)
  for i in range(0, length):
    ek = ek_list[i]
    if (' ' + ek + ' ') in body.lower() or (ek + 'ek') in body.lower() or ('/' + ek) in body.lower():
      output.append(ek_list[i])
  return output

def this_year(thatdate):
  today = datetime.date.today()
  if thatdate.year == today.year - 1:
    if thatdate.month > today.month:
      return True
    elif thatdate.month == today.month and thatdate.day >= today.day:
      return True
  elif thatdate.year == today.year:
    return True

def resort(list, order):
  result = []
  for e in order:
    if e in list:
      result.append(e)
  return result

def plot():
  x = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]
  my_xticks = ['11', '10', '9', '8', '7', '6', '5', '4', '3', '2', '1', '0']  
  plt.xticks(x, my_xticks)
  print unique_ek
  for i in range(0, len(unique_ek)):
    colour = colour_list[ek_list.index(unique_ek[i])]
    plt.plot(x, frequency_list[i], colour, label = unique_ek[i])
  plt.xlabel('Months before today')
  plt.ylabel('Number of mentions')
  plt.legend().draggable()
  plt.title("Frequency of Mention per Month by @" + twitter_name )
  plt.show()

with open(path) as csvfile:
  reader = csv.reader(csvfile, delimiter = ',')
  for row in reader:
    datestr = row[0]
    body = row[1]
    date = datetime.datetime.strptime(datestr, "%Y-%m-%d %H:%M:%S")
    if this_year(date):
      occurance = check(body)
      if occurance:
        for ek in occurance:
          if ek not in unique_ek:
            unique_ek.append(ek)
            frequency_list.append([0]*12)
            unique_ek = resort(unique_ek, ek_list)
          month = get_month(date)
          ek_num = unique_ek.index(ek)
          frequency_list[ek_num][11 - month] += 1
          print ek, body
          print '-------'
print frequency_list
plot()